crystal_doc_search_index_callback({"repository_name":"hace","body":"# HacÃ©\n\nHacÃ© makes things like make, but not the same.\n\nIts functionality is mostly derived from using\n[Croupier](https://github.com/ralsina/croupier), a dataflow library.\n\n[![Docs](https://github.com/ralsina/hace/actions/workflows/static.yml/badge.svg)](https://ralsina.github.io/hace/)\n[![License](https://img.shields.io/badge/License-MIT-green)](https://github.com/ralsina/hace/blob/main/LICENSE)\n[![Release](https://img.shields.io/github/release/ralsina/hace.svg)](https://GitHub.com/ralsina/hace/releases/)\n[![News about Hace](https://img.shields.io/badge/News-About%20Hace-blue)](https://ralsina.me/categories/hace.html)\n\n[![Tests](https://github.com/ralsina/hace/actions/workflows/ci.yml/badge.svg)](https://github.com/ralsina/hace/actions/workflows/ci.yml)\n[![codecov](https://codecov.io/gh/ralsina/hace/branch/main/graph/badge.svg?token=YW23EDL5T5)](https://codecov.io/gh/ralsina/hace)\n[![Mutation Tests](https://github.com/ralsina/hace/actions/workflows/mutation.yml/badge.svg)](https://github.com/ralsina/hace/actions/workflows/mutation.yml)\n\n## Installation\n\nIf you have `crystal` and `shards` installed, you can do:\n\n```sh\ngit clone git@github.com:ralsina/hace.git\ncd hace\nshards build --release\ncp bin/hace ~/.local/bin  # or wherever you want it\n```\n\nBinaries for Linux in amd64 are available in [the releases page](https://github.com/ralsina/hace/releases).\n\n## Usage\n\nYou can use the `hace` command to run tasks from a `Hacefile.yml` in the current\ndirectory.\n\n```console\n$ ./bin/hace --help\n  hace - hace makes things, like make\n\n  Usage:\n    hace [command] [flags] [arguments]\n\n  Commands:\n    auto            Run in auto mode\n    help [command]  Help about any command.\n\n  Flags:\n    -n, --dry-run      Don't actually run any commands\n    -f, --file         Read the file named as a Hacefile default: 'Hacefile.yml'\n    -h, --help         Help for this command.\n    -k, --keep-going   Continue as much as possible after an error.\n        --question     Don't run anything, exit 0 if all tasks are up to date, 1\n                       otherwise\n    -q, --quiet        Don't log anything\n    -B, --always-make  Unconditionally run all tasks.\n    -v, --verbosity    Control the logging verbosity, 0 to 5  default: 3\n```\n\nThe arguments are task names, and if you don't specify any, the default\ntasks will execute.\n\nThat's easy, right? Well, that's because the complicated bit is the Hacefile ðŸ˜ƒ\n\n## The Hacefile\n\nThe Hacefile is a [YAML file](https://spacelift.io/blog/yaml) that\ndescribes the tasks you want to run.\nConceptually it's a lot like a Makefile, but the syntax and semantics are\nquite different.\n\nHere's a simple example, details to be explained below:\n\n```yaml\ntasks:\n  foo:\n    default: true\n    dependencies:\n      - bar\n    commands: |\n      echo \"make foo out of bar\" > foo\n      cat bar >> foo\n  phony:\n    phony: true\n    commands: echo \"bat\" > bat\n```\n\n## Tasks\n\nA task is a named set of shell commands that are run in order, and they go\nunder the `tasks` toplevel key. For example:\n\n```yaml\ntasks:\n  foo:\n    default: true\n    cwd: /tmp\n    dependencies:\n      - bar\n    commands: |\n      echo \"make foo out of bar\" > foo\n      cat bar >> foo\n```\n\nThis defines a task named `foo` that depends on `bar` and runs two commands.\n\nBecause it's marked as `default` it will be run if you don't specify any\ntasks on the command line.\n\nThe optional `cwd` key sets the current working directory for the task.\n\n### Commands\n\nThe commands are a string that can be multiple lines, and they are run in\norder. If any command fails, the task fails.\n\nEach line should be a valid shell command, and they are run in a shell. The\nshell is `/bin/sh` on linux and `cmd.exe` on windows (please note that\nnobody has ever tried this tool on windows AFAIK).\n\nCommands are in fact templates using\n[Jinja](https://github.com/straight-shoota/crinja) syntax,\nsee [Variables](#variables) below for more details and examples.\n\n### Outputs\n\nA task can have zero, one, or multiple outputs. If a task declares it has\noutputs but fails to create them, it's considered to have failed.\n\nIn the example above, there is no explicit `outputs` key, so the task has\none output, named like the task itself: `foo`.\n\nA task can declare it generates no outputs by tagging itself as `phony`:\n\n```yaml\ntask2:\n  dependencies:\n    - bar\n  phony: true\n  commands: |\n    notify-send \"Done: $(cat bar)\"\n```\n\nThis example shows a notification on screen with the contents of the file\n`bar` but doesn't actually create any files.\n\nIf a task generates multiple outputs, you can declare them like this:\n\n```yaml\ntask3:\n  dependencies:\n    - bar\n  outputs:\n    - baz\n    - bat\n  commands: |\n    echo \"This is baz\" > baz\n    echo \"This is bat\" > bat\n```\n\nThis task is **called** `task3` but it generates two files, `baz` and `bat`.\n\n**âš ï¸WARNING:** You can have two tasks with the same output, but you can't\nhave two tasks with the same name.\n\n**âš Warning:** If there are two tasks with the same\noutput, HacÃ© will run them both, and the second one will overwrite the\nfirst. This is a bug, and will be fixed.\n\nOutputs can interpolate variables and environment variables.\n\n### Dependencies\n\nDependencies are files or task names. Hacefile will try to run tasks only\nif a dependency file has changed since the last time the task was run or\nif a task dependency itself would run.\n\nIf a dependency is the output of another task, then that task will run\nfirst (if needed).\n\nIf a dependency is missing and the Hacefile doesn't describe how to\ngenerate it, the task is not ready to run, and there will be an error.\n\nTasks without dependencies are always considered \"out of date\" and\nwill always run if you ask for them.\n\nDependencies can interpolate variables and environment variables.\n\nDependencies will expand \"globs\", such as \"*\", \"**\" and \"?\"\n\n### Default tasks\n\nIf a task has `default` set to `true`, it will run when no task is\nspecified on the command line. You have to set this explicitly if\nyou want it, otherwise no task will run unless explicitly required.\n\n### Always Run\n\nIf a task has `always_run` set to `true`, it will run even if it's\nnot out of date. This is useful for tasks that don't have outputs.\n\n## Environment variables\n\nJust an ordinary map of environment variables in the `env` top\nkey. The variables will be available to all tasks and you can\nexpand them using in commands, dependencies and outputs with `${PATH}`\n\nAny variables in the environment when the Hacefile is loaded will\nalso be in the environment.\n\nIf you want to *unset* a variable, set it to `null`. If you want\nit set to an empty value, use `\"\"`.\n\n```yaml\nenv:\n  FOO: bar\n  BAZ: null\n```\n\n## Variables\n\nYou can declare variables in the `variables` top level key. They are\navailable to all tasks, which can use them in their commands\nusing a [Jinja](https://github.com/straight-shoota/crinja) template language syntax.\n\nA special variable is `self` which is the task itself, so you can\nuse the task itself to define parts of the commands it contains.\n\n**âš ï¸âš ï¸WARNINGâš ï¸âš ï¸** These are *not* [environment variables](#environment-variables).\n\n```yaml\nvariables:\n  i: 3\n  s: \"string\"\n  foo:\n    bar: \"bat\"\n    foo: 86\ntasks:\n  foo:\n    dependencies:\n      - bar\n    commands: |\n      echo \"make foo out of {{ foo['bar'] }} at {{ i }}\" > foo\n      cat {{ self[\"dependencies\"][0] }} >> foo\n```\n\nIn that example, it's doing `cat bar >> foo` because that's in\n`self[\"dependencies\"]`. This may look a bit confusing but I expect\nit will be useful.\n\nCurrently the available members of `self` are:\n\n* commands: all commands\n* dependencies: all dependencies, as an array\n* phony: boolean\n* default: boolean\n* outputs: all outputs, as an array\n\nYou can also set variables from the command line. This example sets `VAR` to `VALUE`:\n\n```sh\nhace foo VAR=VALUE\n```\n\nVariables can interpolate environment variables:\n\n```yaml\nvariables:\n  dest_dir: \"${HOME}/.local/bin\"\n```\n\nBecause we are using [templates](https://github.com/straight-shoota/crinja/blob/master/TEMPLATE_SYNTAX.md)\nyou can even do things like this:\n\n```yaml\ntasks:\n  foo:\n    default: true\n    outputs:\n      - foo\n    dependencies:\n      - \"*.c\"\n    commands: |\n      {% for dep in self[\"dependencies\"] %} gcc -c {{dep}} {% endfor %}\n```\n\n## Development\n\nSee [TODO.md](TODO.md) for a list of things that are not done yet,\nas well as things that were considered and decided against (TODON'T ðŸ˜€)\n\nMain things to consider if you want to contribute:\n\n* Take tests seriously. When a project is small, it's easy to test\n  everything.\n\n  When it's big, it's impossible to test everything. So, start testing early\n  and keep testing often.\n\n* Take documentation seriously. If you don't document it, it doesn't exist.\n\n## Contributing\n\n1. Fork it (<https://github.com/ralsina/hace/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n* [Roberto Alsina](https://github.com/ralsina) - creator and maintainer\n","program":{"html_id":"hace/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"ancestors":[{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},{"html_id":"hace/Spec/Methods","kind":"module","full_name":"Spec::Methods","name":"Methods"},{"html_id":"hace/Spec/Expectations","kind":"module","full_name":"Spec::Expectations","name":"Expectations"},{"html_id":"hace/Croupier","kind":"module","full_name":"Croupier","name":"Croupier"}],"locations":[],"repository_name":"hace","program":true,"enum":false,"alias":false,"const":false,"constants":[{"id":"DOC","name":"DOC","value":"\"hace makes things, like make.\\n\\nUsage:\\n  hace [options] [<task>...]\\n  hace --completion=<shell>\\n  hace --help\\n\\nOptions:\\n  -f <file>, --file=<file>     Read the file named as a Hacefile [default: Hacefile.yml]\\n  -n, --dry-run                Don't actually run any commands\\n  -q, --quiet                  Don't log anything\\n  -v <level>, --verbosity=<level>  Control the logging verbosity, 0 to 5 [default: 3]\\n  -B, --always-make            Unconditionally run all tasks\\n  -k, --keep-going             Continue as much as possible after an error\\n  --parallel                   Run tasks in parallel when possible\\n  --question                   Don't run anything, exit 0 if all tasks are up to date, 1 otherwise\\n  --list                       List available tasks\\n  --auto                       Run in auto mode, watching for file changes\\n  --completion=<shell>         Generate shell completion script (bash, fish, zsh)\\n  --version                    Display version information\\n  -h, --help                   Show this help message\""}],"included_modules":[{"html_id":"hace/Croupier","kind":"module","full_name":"Croupier","name":"Croupier"},{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},{"html_id":"hace/Spec/Expectations","kind":"module","full_name":"Spec::Expectations","name":"Expectations"},{"html_id":"hace/Spec/Methods","kind":"module","full_name":"Spec::Methods","name":"Methods"}],"extended_modules":[{"html_id":"hace/Croupier","kind":"module","full_name":"Croupier","name":"Croupier"},{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},{"html_id":"hace/Spec/Expectations","kind":"module","full_name":"Spec::Expectations","name":"Expectations"},{"html_id":"hace/Spec/Methods","kind":"module","full_name":"Spec::Methods","name":"Methods"}],"types":[{"html_id":"hace/Hace","path":"Hace.html","kind":"module","full_name":"Hace","name":"Hace","abstract":false,"locations":[{"filename":"src/hace.cr","line_number":8,"url":null}],"repository_name":"hace","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"ENVIRONMENT","name":"ENVIRONMENT","value":"{} of String => String"},{"id":"VARIABLES","name":"VARIABLES","value":"{} of String => YAML::Any"},{"id":"VERSION","name":"VERSION","value":"{{ (`shards version /home/ralsina/code/hace/src`).chomp.stringify }}"}],"extended_modules":[{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"}],"class_methods":[{"html_id":"expand_glob(str:String):Array(String)-class-method","name":"expand_glob","abstract":false,"args":[{"name":"str","external_name":"str","restriction":"String"}],"args_string":"(str : String) : Array(String)","args_html":"(str : String) : Array(String)","location":{"filename":"src/hace.cr","line_number":381,"url":null},"def":{"name":"expand_glob","args":[{"name":"str","external_name":"str","restriction":"String"}],"return_type":"Array(String)","visibility":"Public","body":"expanded = (Dir.glob(str)).to_a\nif expanded.empty?\nelse\n  return expanded\nend\n[str]\n"},"external_var":false},{"html_id":"expand_string(str:String,variables=Hace::VARIABLES):String-class-method","name":"expand_string","abstract":false,"args":[{"name":"str","external_name":"str","restriction":"String"},{"name":"variables","default_value":"Hace::VARIABLES","external_name":"variables","restriction":""}],"args_string":"(str : String, variables = Hace::VARIABLES) : String","args_html":"(str : String, variables = <span class=\"t\">Hace</span><span class=\"t\">::</span><span class=\"t\">VARIABLES</span>) : String","location":{"filename":"src/hace.cr","line_number":371,"url":null},"def":{"name":"expand_string","args":[{"name":"str","external_name":"str","restriction":"String"},{"name":"variables","default_value":"Hace::VARIABLES","external_name":"variables","restriction":""}],"return_type":"String","visibility":"Public","body":"str = Crinja.render(str, variables)\n\nstr = str.gsub(/\\$\\{?(\\w+)\\}?/) do |match|\n  env_key = $~[1]\n  ENV.fetch(env_key) do match end\nend\n"},"external_var":false}],"types":[{"html_id":"hace/Hace/CommandTask","path":"Hace/CommandTask.html","kind":"class","full_name":"Hace::CommandTask","name":"CommandTask","abstract":false,"superclass":{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"hace/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"},{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"hace/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/hace.cr","line_number":293,"url":null}],"repository_name":"hace","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"hace/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"}],"namespace":{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},"doc":"A task that runs a shell command","summary":"<p>A task that runs a shell command</p>","constructors":[{"html_id":"new(ctx:YAML::ParseContext,node:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"args_string":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","args_html":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":294,"url":null},"def":{"name":"new","args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"visibility":"Public","body":"new_from_yaml_node(ctx, node)"},"external_var":false},{"html_id":"new(*,__context_for_yaml_serializablectx:YAML::ParseContext,__node_for_yaml_serializablenode:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"args_string":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","args_html":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":294,"url":null},"def":{"name":"new","args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"splat_index":0,"visibility":"Public","body":"_ = allocate\n_.initialize(__context_for_yaml_serializable: ctx, __node_for_yaml_serializable: node)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"expand-instance-method","name":"expand","doc":"We want to support variables and environment variables also in things\nlike dependencies, outputs, etc. so we need to do some post-processing\n\nBesides the global VARIABLES, they also have access to self","summary":"<p>We want to support variables and environment variables also in things like dependencies, outputs, etc.</p>","abstract":false,"location":{"filename":"src/hace.cr","line_number":316,"url":null},"def":{"name":"expand","visibility":"Public","body":"variables = {\"self\" => self.to_hash}.merge(Hace::VARIABLES)\n@outputs = @outputs.map do |outp| Hace.expand_string(outp, variables) end\nvariables = {\"self\" => self.to_hash}.merge(Hace::VARIABLES)\n\n\n@dependencies = @dependencies.map do |dep| Hace.expand_string(dep, variables) end\n@dependencies = @dependencies.flat_map do |dep| Hace.expand_glob(dep) end\nvariables = {\"self\" => self.to_hash}.merge(Hace::VARIABLES)\n@commands = Hace.expand_string(@commands, variables)\n"},"external_var":false},{"html_id":"gen_task(name)-instance-method","name":"gen_task","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""}],"args_string":"(name)","args_html":"(name)","location":{"filename":"src/hace.cr","line_number":328,"url":null},"def":{"name":"gen_task","args":[{"name":"name","external_name":"name","restriction":""}],"visibility":"Public","body":"if @phony && !@outputs.empty?\n  Log.warn do \"Task #{name} is phony but has outputs #{@outputs}. Outputs will be ignored.\" end\n  @outputs = [] of String\nend\nif @outputs.empty?\n  @outputs = @phony ? [] of String : [name]\nend\ncommands = (@commands.split(\"\\n\")).map(&.strip).reject(&.empty?)\n\nTask.new(outputs: @outputs, inputs: @dependencies, mergeable: true, no_save: true, always_run: @always_run, proc: TaskProc.new do\n  Log.info do \"Started task: #{name}\" end\n  cwd = @cwd.nil? ? Dir.current : @cwd.as(String)\n  Dir.cd(cwd) do\n    commands.map do |command|\n      Log.info do \"Running command: #{command}\" end\n      status = Process.run(command: command, shell: true, env: Hace::ENVIRONMENT, input: Process::Redirect::Inherit, output: Process::Redirect::Inherit, error: Process::Redirect::Inherit)\n      if status.success?\n      else\n        raise(\"Command failed: exit #{status.exit_code} when running #{command}\")\n      end\n      status.to_s\n    end\n  end\n  Log.info do \"Finished task: #{name}\" end\nend, id: name)\n"},"external_var":false},{"html_id":"to_hash-instance-method","name":"to_hash","abstract":false,"location":{"filename":"src/hace.cr","line_number":306,"url":null},"def":{"name":"to_hash","visibility":"Public","body":"(YAML.parse(self.to_yaml)).as_h"},"external_var":false}]},{"html_id":"hace/Hace/HaceFile","path":"Hace/HaceFile.html","kind":"class","full_name":"Hace::HaceFile","name":"HaceFile","abstract":false,"superclass":{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"hace/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"},{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"hace/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/hace.cr","line_number":22,"url":null}],"repository_name":"hace","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"hace/YAML/Serializable/Strict","kind":"module","full_name":"YAML::Serializable::Strict","name":"Strict"}],"namespace":{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},"doc":"Parser for Hacefile.yml","summary":"<p>Parser for Hacefile.yml</p>","class_methods":[{"html_id":"auto(arguments=[]ofString,filename=\"Hacefile.yml\")-class-method","name":"auto","abstract":false,"args":[{"name":"arguments","default_value":"[] of String","external_name":"arguments","restriction":""},{"name":"filename","default_value":"\"Hacefile.yml\"","external_name":"filename","restriction":""}],"args_string":"(arguments = [] of String, filename = \"Hacefile.yml\")","args_html":"(arguments = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, filename = <span class=\"s\">&quot;Hacefile.yml&quot;</span>)","location":{"filename":"src/hace.cr","line_number":270,"url":null},"def":{"name":"auto","args":[{"name":"arguments","default_value":"[] of String","external_name":"arguments","restriction":""},{"name":"filename","default_value":"\"Hacefile.yml\"","external_name":"filename","restriction":""}],"visibility":"Public","body":"hacefile = load_file(filename)\nhacefile.gen_tasks\nbegin\n  real_arguments = process_arguments(hacefile, arguments)\n  Log.info do \"Running tasks: #{arguments.join(\", \")}\" end\n  TaskManager.auto_run(real_arguments)\nrescue ex\n  Log.error do ex end\n  return 1\nend\nLog.info do \"Running in auto mode, press Ctrl+C to stop\" end\nloop do\n  ::sleep(1.seconds)\nend\n"},"external_var":false},{"html_id":"load_file(filename)-class-method","name":"load_file","abstract":false,"args":[{"name":"filename","external_name":"filename","restriction":""}],"args_string":"(filename)","args_html":"(filename)","location":{"filename":"src/hace.cr","line_number":30,"url":null},"def":{"name":"load_file","args":[{"name":"filename","external_name":"filename","restriction":""}],"visibility":"Public","body":"begin\n  if !(File.exists?(filename))\n    raise(\"No Hacefile '#{filename}' found\")\n  end\n\n\n\n  data = File.read(filename)\n  p = Hace::PartialHaceFile.from_yaml(data)\n\n  rendered_data = (data.split(\"\\n\")).map do |line|\n    begin\n      Crinja.render(line, p.variables)\n    rescue\n      line\n    end\n  end.join(\"\\n\")\n\n  f = Hace::HaceFile.from_yaml(rendered_data)\n  ENV.each do |k, v| Hace::ENVIRONMENT[k] = v end\n  f.env.each do |k, v|\n    if v.nil?\n      Hace::ENVIRONMENT.delete(k)\n    else\n      Hace::ENVIRONMENT[k] = v\n    end\n  end\n\n\n  f.variables.each do |k, v|\n    VARIABLES[k] = YAML.parse(Hace.expand_string(v.to_yaml))\n  end\n\n\n  f.tasks.each do |_, task| task.expand end\nrescue ex\n  raise(\"Error parsing Hacefile '#{filename}': #{ex}\")\nend\nf\n"},"external_var":false},{"html_id":"process_arguments(hacefile,arguments:Array(String))-class-method","name":"process_arguments","abstract":false,"args":[{"name":"hacefile","external_name":"hacefile","restriction":""},{"name":"arguments","external_name":"arguments","restriction":"Array(String)"}],"args_string":"(hacefile, arguments : Array(String))","args_html":"(hacefile, arguments : Array(String))","location":{"filename":"src/hace.cr","line_number":229,"url":null},"def":{"name":"process_arguments","args":[{"name":"hacefile","external_name":"hacefile","restriction":""},{"name":"arguments","external_name":"arguments","restriction":"Array(String)"}],"visibility":"Public","body":"if arguments.empty?\n  Log.info do \"Using default tasks\" end\n  hacefile.tasks.each do |name, task|\n    if task.@default\n      arguments << name\n    end\n  end\nend\n\nreal_arguments = [] of String\n\narguments.each do |arg|\n  p_args = [] of String\n  hacefile.tasks.each do |name, task|\n    if arg == name\n      p_args = p_args + (task.@outputs)\n\n      if task.@phony\n        p_args << name\n      end\n    elsif (task.@outputs).includes?(arg)\n      p_args << arg\n    end\n  end\n\n  if p_args.empty?\n    Log.warn do \"Task #{arg} not found\" end\n  end\n  real_arguments = real_arguments + p_args\nend\nreal_arguments = (Set.new(real_arguments)).to_a\n"},"external_var":false},{"html_id":"run(arguments=[]ofString,filename=\"Hacefile.yml\",run_all:Bool=false,dry_run:Bool=false,question:Bool=false,keep_going:Bool=false,parallel:Bool=false)-class-method","name":"run","abstract":false,"args":[{"name":"arguments","default_value":"[] of String","external_name":"arguments","restriction":""},{"name":"filename","default_value":"\"Hacefile.yml\"","external_name":"filename","restriction":""},{"name":"run_all","default_value":"false","external_name":"run_all","restriction":"Bool"},{"name":"dry_run","default_value":"false","external_name":"dry_run","restriction":"Bool"},{"name":"question","default_value":"false","external_name":"question","restriction":"Bool"},{"name":"keep_going","default_value":"false","external_name":"keep_going","restriction":"Bool"},{"name":"parallel","default_value":"false","external_name":"parallel","restriction":"Bool"}],"args_string":"(arguments = [] of String, filename = \"Hacefile.yml\", run_all : Bool = false, dry_run : Bool = false, question : Bool = false, keep_going : Bool = false, parallel : Bool = false)","args_html":"(arguments = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, filename = <span class=\"s\">&quot;Hacefile.yml&quot;</span>, run_all : Bool = <span class=\"n\">false</span>, dry_run : Bool = <span class=\"n\">false</span>, question : Bool = <span class=\"n\">false</span>, keep_going : Bool = <span class=\"n\">false</span>, parallel : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/hace.cr","line_number":141,"url":null},"def":{"name":"run","args":[{"name":"arguments","default_value":"[] of String","external_name":"arguments","restriction":""},{"name":"filename","default_value":"\"Hacefile.yml\"","external_name":"filename","restriction":""},{"name":"run_all","default_value":"false","external_name":"run_all","restriction":"Bool"},{"name":"dry_run","default_value":"false","external_name":"dry_run","restriction":"Bool"},{"name":"question","default_value":"false","external_name":"question","restriction":"Bool"},{"name":"keep_going","default_value":"false","external_name":"keep_going","restriction":"Bool"},{"name":"parallel","default_value":"false","external_name":"parallel","restriction":"Bool"}],"visibility":"Public","body":"setup = ExecutionSetup.from_arguments(arguments: arguments, filename: filename, run_all: run_all, dry_run: dry_run, question: question, keep_going: keep_going, parallel: parallel)\n\n\nif setup.question?\n  return handle_question_mode(setup)\nend\n\n\ntargets = resolve_targets(setup)\nif targets.empty?\n  return handle_no_targets(setup)\nend\n\n\nexecute_tasks(targets, setup)\n"},"external_var":false}],"constructors":[{"html_id":"new(ctx:YAML::ParseContext,node:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"args_string":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","args_html":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":23,"url":null},"def":{"name":"new","args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"visibility":"Public","body":"new_from_yaml_node(ctx, node)"},"external_var":false},{"html_id":"new(*,__context_for_yaml_serializablectx:YAML::ParseContext,__node_for_yaml_serializablenode:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"args_string":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","args_html":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":23,"url":null},"def":{"name":"new","args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"splat_index":0,"visibility":"Public","body":"_ = allocate\n_.initialize(__context_for_yaml_serializable: ctx, __node_for_yaml_serializable: node)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"env:Hash(String,String?)-instance-method","name":"env","abstract":false,"location":{"filename":"src/hace.cr","line_number":28,"url":null},"def":{"name":"env","visibility":"Public","body":"@env"},"external_var":false},{"html_id":"env=(env:Hash(String,Nil|String))-instance-method","name":"env=","abstract":false,"args":[{"name":"env","external_name":"env","restriction":"::Hash(::String, ::Nil | ::String)"}],"args_string":"(env : Hash(String, Nil | String))","args_html":"(env : Hash(String, Nil | String))","location":{"filename":"src/hace.cr","line_number":28,"url":null},"def":{"name":"env=","args":[{"name":"env","external_name":"env","restriction":"::Hash(::String, ::Nil | ::String)"}],"visibility":"Public","body":"@env = env"},"external_var":false},{"html_id":"gen_tasks-instance-method","name":"gen_tasks","abstract":false,"location":{"filename":"src/hace.cr","line_number":264,"url":null},"def":{"name":"gen_tasks","visibility":"Public","body":"@tasks.each do |name, task|\n  task.gen_task(name)\nend"},"external_var":false},{"html_id":"tasks:Hash(String,CommandTask)-instance-method","name":"tasks","abstract":false,"location":{"filename":"src/hace.cr","line_number":26,"url":null},"def":{"name":"tasks","return_type":"Hash(String, CommandTask)","visibility":"Public","body":"@tasks"},"external_var":false},{"html_id":"tasks=(tasks:Hash(String,CommandTask))-instance-method","name":"tasks=","abstract":false,"args":[{"name":"tasks","external_name":"tasks","restriction":"Hash(String, CommandTask)"}],"args_string":"(tasks : Hash(String, CommandTask))","args_html":"(tasks : Hash(String, <a href=\"../Hace/CommandTask.html\">CommandTask</a>))","location":{"filename":"src/hace.cr","line_number":26,"url":null},"def":{"name":"tasks=","args":[{"name":"tasks","external_name":"tasks","restriction":"Hash(String, CommandTask)"}],"visibility":"Public","body":"@tasks = tasks"},"external_var":false},{"html_id":"variables:Hash(String,YAML::Any)-instance-method","name":"variables","abstract":false,"location":{"filename":"src/hace.cr","line_number":27,"url":null},"def":{"name":"variables","return_type":"Hash(String, YAML::Any)","visibility":"Public","body":"@variables"},"external_var":false},{"html_id":"variables=(variables:Hash(String,YAML::Any))-instance-method","name":"variables=","abstract":false,"args":[{"name":"variables","external_name":"variables","restriction":"Hash(String, YAML::Any)"}],"args_string":"(variables : Hash(String, YAML::Any))","args_html":"(variables : Hash(String, YAML::Any))","location":{"filename":"src/hace.cr","line_number":27,"url":null},"def":{"name":"variables=","args":[{"name":"variables","external_name":"variables","restriction":"Hash(String, YAML::Any)"}],"visibility":"Public","body":"@variables = variables"},"external_var":false}]},{"html_id":"hace/Hace/PartialHaceFile","path":"Hace/PartialHaceFile.html","kind":"class","full_name":"Hace::PartialHaceFile","name":"PartialHaceFile","abstract":false,"superclass":{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"},{"html_id":"hace/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"hace/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/hace.cr","line_number":16,"url":null}],"repository_name":"hace","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"hace/YAML/Serializable","kind":"module","full_name":"YAML::Serializable","name":"Serializable"}],"namespace":{"html_id":"hace/Hace","kind":"module","full_name":"Hace","name":"Hace"},"doc":"This parses only env and variables, not tasks","summary":"<p>This parses only env and variables, not tasks</p>","constructors":[{"html_id":"new(ctx:YAML::ParseContext,node:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"args_string":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","args_html":"(ctx : YAML::ParseContext, node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":17,"url":null},"def":{"name":"new","args":[{"name":"ctx","external_name":"ctx","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"node","restriction":"::YAML::Nodes::Node"}],"visibility":"Public","body":"new_from_yaml_node(ctx, node)"},"external_var":false},{"html_id":"new(*,__context_for_yaml_serializablectx:YAML::ParseContext,__node_for_yaml_serializablenode:YAML::Nodes::Node)-class-method","name":"new","abstract":false,"args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"args_string":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","args_html":"(*, __context_for_yaml_serializable ctx : YAML::ParseContext, __node_for_yaml_serializable node : YAML::Nodes::Node)","location":{"filename":"src/hace.cr","line_number":17,"url":null},"def":{"name":"new","args":[{"name":"","external_name":"","restriction":""},{"name":"ctx","external_name":"__context_for_yaml_serializable","restriction":"::YAML::ParseContext"},{"name":"node","external_name":"__node_for_yaml_serializable","restriction":"::YAML::Nodes::Node"}],"splat_index":0,"visibility":"Public","body":"_ = allocate\n_.initialize(__context_for_yaml_serializable: ctx, __node_for_yaml_serializable: node)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"variables:Hash(String,YAML::Any)-instance-method","name":"variables","abstract":false,"location":{"filename":"src/hace.cr","line_number":18,"url":null},"def":{"name":"variables","return_type":"Hash(String, YAML::Any)","visibility":"Public","body":"@variables"},"external_var":false},{"html_id":"variables=(variables:Hash(String,YAML::Any))-instance-method","name":"variables=","abstract":false,"args":[{"name":"variables","external_name":"variables","restriction":"Hash(String, YAML::Any)"}],"args_string":"(variables : Hash(String, YAML::Any))","args_html":"(variables : Hash(String, YAML::Any))","location":{"filename":"src/hace.cr","line_number":18,"url":null},"def":{"name":"variables=","args":[{"name":"variables","external_name":"variables","restriction":"Hash(String, YAML::Any)"}],"visibility":"Public","body":"@variables = variables"},"external_var":false}]}]},{"html_id":"hace/LogFormat","path":"LogFormat.html","kind":"struct","full_name":"LogFormat","name":"LogFormat","abstract":false,"superclass":{"html_id":"hace/Log/StaticFormatter","kind":"struct","full_name":"Log::StaticFormatter","name":"StaticFormatter"},"ancestors":[{"html_id":"hace/Log/StaticFormatter","kind":"struct","full_name":"Log::StaticFormatter","name":"StaticFormatter"},{"html_id":"hace/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"hace/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"hace/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/main.cr","line_number":194,"url":null}],"repository_name":"hace","program":false,"enum":false,"alias":false,"const":false,"doc":"Log formatter for Hace","summary":"<p>Log formatter for Hace</p>","class_methods":[{"html_id":"setup(quiet:Bool,verbosity)-class-method","name":"setup","abstract":false,"args":[{"name":"quiet","external_name":"quiet","restriction":"Bool"},{"name":"verbosity","external_name":"verbosity","restriction":""}],"args_string":"(quiet : Bool, verbosity)","args_html":"(quiet : Bool, verbosity)","location":{"filename":"src/main.cr","line_number":208,"url":null},"def":{"name":"setup","args":[{"name":"quiet","external_name":"quiet","restriction":"Bool"},{"name":"verbosity","external_name":"verbosity","restriction":""}],"visibility":"Public","body":"if quiet\n  _verbosity = Log::Severity::Fatal\nelse\n  _verbosity = [Log::Severity::Fatal, Log::Severity::Error, Log::Severity::Warn, Log::Severity::Info, Log::Severity::Debug, Log::Severity::Trace][[verbosity, 5].min]\nend\nLog.setup(_verbosity, Log::IOBackend.new(io: STDERR, formatter: LogFormat))\n"},"external_var":false}],"instance_methods":[{"html_id":"run-instance-method","name":"run","doc":"Subclasses must implement this method to define the output pattern","summary":"<p>Subclasses must implement this method to define the output pattern</p>","abstract":false,"location":{"filename":"src/main.cr","line_number":204,"url":null},"def":{"name":"run","visibility":"Public","body":"string(\"[#{Time.local}] #{@entry.severity.label}: #{@entry.message}\".colorize(@@colors[@entry.severity.label]))"},"external_var":false}]}]}})
